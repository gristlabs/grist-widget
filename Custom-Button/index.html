<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Custom Widget</title>
    <script src="https://docs.getgrist.com/grist-plugin-api.js"></script>
    <style>
    body {
      margin: 0;
      padding: 0;
    }
    
    .nav-container {
      border-radius: 0;
      display: flex;
      flex-direction: column;
      background-color: #F6F3E8;
      padding: 0;
    }

    .nav-bar {
      align-items: center;
      display: flex;
      width: 100%;
      gap: 10px;
      padding: 0;
    }

    .button-container {
      display: flex;
      align-items: center;
      gap: 10px;
      margin: 0 auto;
      width: 100%;
      padding: 20px;
    }

    .side-buttons {
      display: flex;
      flex-direction: column;
      gap: 5px;
    }

    .copy-btn {
      align-self: stretch;
      border-radius: 8px;
      background-color: #A6D7A7;
      min-height: 50px;
      width: 100px;
      padding: 5px 10px;
      color: #333;
      font: 500 12px/18px Arial;
      border: none;
      font-weight: bolder;
      cursor: pointer;
    }

    .copy-btn:hover {
      background-color: #95c696;
    }

    .link-button {
      background-color: #C6F4C5;
      border: none;
      padding: 5px 10px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 12px;
      text-decoration: none;
      color: #333;
      display: inline-block;
    }

    .link-button:hover {
      background-color: #b5e3b4;
    }

    #co-star {
      background-color: #ADD8E6;
    }

    #co-star:hover {
      background-color: #9cc7d5;
    }

    #street-view {
      background-color: #E5D9B7;
    }

    #street-view:hover {
      background-color: #d4c8a6;
    }

    #error {
      color: red;
      font-size: 12px;
      text-align: center;
      margin-top: 5px;
      display: none;
    }
  </style>
</head>
<body>
  <div class="nav-container">
    <nav class="nav-bar" role="navigation">
      <div class="button-container">
        <!-- Left Buttons -->
        <div class="side-buttons">
          <a id="county" class="link-button" href="#" draggable="true">üîç</a>
          <a id="gis" class="link-button" href="#" draggable="true">üåé</a>
        </div>
        
        <!-- Center Copy Button -->
        <button class="copy-btn" id="copy" onclick="copyText()">Copy</button>
        
        <!-- Right Buttons -->
        <div class="side-buttons">
          <a id="co-star" class="link-button" href="#" draggable="true">üè¢</a>
          <a id="street-view" class="link-button" href="#" draggable="true">üõ£Ô∏è</a>
        </div>
      </div>
      <div id="error"></div>
    </nav>
  </div>
  <script>
  
      let links = {
      county: '',
      streetView: '',
      coStar: '',
      gis: '',
      copy: ''
    };

    function updateLinks() {
      document.getElementById('county').href = links.county || '#';
      document.getElementById('street-view').href = links.streetView || '#';
      document.getElementById('co-star').href = links.coStar || '#';
      document.getElementById('gis').href = links.gis || '#';
    }

    function copyText() {
      const textToCopy = links.copy;
      if (textToCopy) {
        const tempTextArea = document.createElement('textarea');
        tempTextArea.value = textToCopy;
        document.body.appendChild(tempTextArea);
        tempTextArea.select();
        tempTextArea.setSelectionRange(0, 99999);
        try {
          document.execCommand('copy');
          const copyBtn = document.getElementById('copy');
          copyBtn.innerHTML = "Copied!";
          setTimeout(() => copyBtn.innerHTML = "Copy", 2000);
        } catch (err) {
          console.error("Clipboard access denied.", err);
          showError("Clipboard access denied.");
        }
        document.body.removeChild(tempTextArea);
      } else {
        showError("No text available to copy.");
      }
    }

    function showError(msg) {
      const el = document.getElementById('error');
      if (!msg) {
        el.style.display = 'none';
      } else {
        el.innerText = msg;
        el.style.display = 'block';
      }
    }

    // Grist integration
    grist.ready({
      columns: ["County", "Street_View", "CoStar", "GIS", "Copy"]
    });

    grist.onRecord(function(record) {
      const mapped = grist.mapColumnNames(record);
      
      links.county = mapped?.County || '';
      links.streetView = mapped?.Street_View || '';
      links.coStar = mapped?.CoStar || '';
      links.gis = mapped?.GIS || '';
      links.copy = mapped?.Copy || '';
      
      updateLinks();
      showError("");
    });
      </script>
    </div>
  </body>
</html>

